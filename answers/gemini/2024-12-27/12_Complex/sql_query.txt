
SELECT s.staff_id, s.first_name || ' ' || s.last_name AS staff_name, COUNT(DISTINCT o.order_id) AS total_orders, SUM(oi.quantity * oi.list_price * (1 - oi.discount)) AS total_revenue, CAST(COUNT(DISTINCT o.order_id) AS REAL) * 100 / (SELECT COUNT(*) FROM orders) AS conversion_rate, CASE WHEN COUNT(DISTINCT o.order_id) > 0 THEN SUM(oi.quantity * oi.list_price * (1 - oi.discount)) / COUNT(DISTINCT o.order_id) ELSE 0 END AS avg_order_value FROM staffs s JOIN orders o ON s.staff_id = o.staff_id JOIN order_items oi ON o.order_id = oi.order_id GROUP BY s.staff_id, staff_name ORDER BY total_revenue DESC;
